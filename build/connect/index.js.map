{"version":3,"sources":["../../src/connect/index.js"],"names":["micro","plugin","settings","Promise","resolve","reject","errorHandler","client","createClient","retry_strategy","on","error","logger","id","info","payload"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;kBAEe,UAACA,KAAD,EAAQC,MAAR;AAAA,MAAgBC,QAAhB,uEAA2B,EAA3B;AAAA,SAAkC,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAChF,QAAMC,eAAe,4BAAaN,KAAb,CAArB;AACA,QAAMO,SAAS,gBACZC,YADY;AAEXC;AAFW,OAGRP,QAHQ,EAAf;;AAMAK,WACGG,EADH,CACM,OADN,EACeJ,YADf,EAEGI,EAFH,CAEM,OAFN,EAEe,iBAAS;AACpB,UAAIC,KAAJ,EAAW;AACTX,cAAMY,MAAN,CAAaD,KAAb,0HAAkD;AAChDE,cAAIZ,OAAOY,EADqC;AAEhDF;AAFgD,SAAlD;;AAKA,eAAON,OAAOM,KAAP,CAAP;AACD;AACDX,YAAMY,MAAN,CAAaE,IAAb,gIAAkD;AAChDD,YAAIZ,OAAOY,EADqC;AAEhDE,8BAAcb,QAAd;AAFgD,OAAlD;;AAKAE,cAAQG,MAAR;AACD,KAjBH;AAkBD,GA1BgD,CAAlC;AAAA,C","file":"index.js","sourcesContent":["import redis from 'redis';\nimport ErrorHandler from './../utils/error-handler';\nimport retryStrategy from './retry-strategy';\n\nexport default (micro, plugin, settings = {}) => new Promise((resolve, reject) => {\n  const errorHandler = ErrorHandler(micro);\n  const client = redis\n    .createClient({\n      retry_strategy: retryStrategy,\n      ...settings\n    });\n  \n  client\n    .on(\"error\", errorHandler)\n    .on(\"ready\", error => {\n      if (error) {\n        micro.logger.error(`Ошибка подключения к Redis:`, {\n          id: plugin.id,\n          error\n        });\n\n        return reject(error);\n      }\n      micro.logger.info(`Создано подключение к Redis:`, {\n        id: plugin.id,\n        payload: { ...settings }\n      });\n\n      resolve(client);\n    });\n});"]}