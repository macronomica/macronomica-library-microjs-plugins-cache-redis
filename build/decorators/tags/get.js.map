{"version":3,"sources":["../../../src/decorators/tags/get.js"],"names":["micro","client","tags","Promise","resolve","reject","hasManyTags","length","hmget","callback","hgetall","err","result","logger","error","code","message","join","reduced","keys","values","reduceKeys","reduceValues","reduce","key","i","Object","assign","value"],"mappings":";;;;;;AAAA;;;;kBAEe,UAACA,KAAD,EAAQC,MAAR;AAAA,SAAmB;AAAA,sCAAIC,IAAJ;AAAIA,UAAJ;AAAA;;AAAA,WAAa,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC9E,UAAMC,cAAcJ,KAAKK,MAAzB;;AAEAD,oBACIL,OAAOO,KAAP,4CAA0BN,IAA1B,GAAgCO,QAAhC,GADJ,GAEIR,OAAOS,OAAP,sBAAyBD,QAAzB,CAFJ;;AAIA,eAASA,QAAT,CAAkBE,GAAlB,EAAuBC,MAAvB,EAA+B;AAC7B,YAAID,GAAJ,EAAS;AACPX,gBAAMa,MAAN,CAAaC,KAAb,CAAmBH,GAAnB;AACA,iBAAON,OAAO;AACZU,oDAA0CJ,IAAII,IADlC;AAEZC,2JAAqCd,KAAKe,IAAL,CAAU,GAAV,CAArC;AAFY,WAAP,CAAP;AAID;;AAED,YAAIL,WAAW,IAAX,IAAmB,CAACN,WAAxB,EAAqC;AACnC,iBAAOF,QAAQQ,MAAR,CAAP;AACD;;AAEDR,gBAAQc,QAAQhB,IAAR,EAAcU,MAAd,CAAR;AACD;AACF,KAtB8C,CAAb;AAAA,GAAnB;AAAA,C;;AAwBf,SAASM,OAAT,CAAiBC,IAAjB,EAAuBC,MAAvB,EAA+B;AAC7B,SAAOD,KAAKZ,MAAL,GAAca,OAAOb,MAArB,GACHc,WAAWF,IAAX,EAAiBC,MAAjB,CADG,GAEHE,aAAaH,IAAb,EAAmBC,MAAnB,CAFJ;AAGD;;AAED,SAASC,UAAT,CAAoBF,IAApB,EAA0BC,MAA1B,EAAkC;AAChC,SAAOD,KAAKI,MAAL,CAAY,UAACX,MAAD,EAASY,GAAT,EAAcC,CAAd;AAAA,WAAoBC,OAAOC,MAAP,CAAcf,MAAd,sBAA0BY,GAA1B,EAAiCJ,OAAQK,CAAR,CAAjC,EAApB;AAAA,GAAZ,EAAiF,EAAjF,CAAP;AACD;;AAED,SAASH,YAAT,CAAsBH,IAAtB,EAA4BC,MAA5B,EAAoC;AAClC,SAAOA,OAAOG,MAAP,CAAc,UAACX,MAAD,EAASgB,KAAT,EAAgBH,CAAhB;AAAA,WAAsBC,OAAOC,MAAP,CAAcf,MAAd,sBAA0BO,KAAMM,CAAN,CAA1B,EAAuCG,KAAvC,EAAtB;AAAA,GAAd,EAAqF,EAArF,CAAP;AACD","file":"get.js","sourcesContent":["import { TAGS_KEY } from './constants';\n\nexport default (micro, client) => (...tags) => new Promise((resolve, reject) => {\n  const hasManyTags = tags.length;\n  \n  hasManyTags\n    ? client.hmget(TAGS_KEY, ...tags, callback)\n    : client.hgetall(TAGS_KEY, callback);\n\n  function callback(err, result) {\n    if (err) {\n      micro.logger.error(err);\n      return reject({\n        code   : `error.plugin-cache-redis.tag/${ err.code }`,\n        message: `Попытка установки тегов ${ tags.join(',') } привела к ошибке`\n      });\n    }\n    \n    if (result === null || !hasManyTags) {\n      return resolve(result);\n    }\n    \n    resolve(reduced(tags, result));\n  }\n});\n\nfunction reduced(keys, values) {\n  return keys.length > values.length\n    ? reduceKeys(keys, values)\n    : reduceValues(keys, values);\n}\n\nfunction reduceKeys(keys, values) {\n  return keys.reduce((result, key, i) => Object.assign(result, { [ key ]: values[ i ] }), {});\n}\n\nfunction reduceValues(keys, values) {\n  return values.reduce((result, value, i) => Object.assign(result, { [ keys[ i ] ]: value }), {});\n}"]}