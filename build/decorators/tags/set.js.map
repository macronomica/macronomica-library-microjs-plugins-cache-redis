{"version":3,"sources":["../../../src/decorators/tags/set.js"],"names":["reduceTags","micro","client","tags","Promise","resolve","reject","result","hmset","keys","err","res","logger","error","code","message","join","reduce","tag","Date","now","push"],"mappings":";;;;;QAkBgBA,U,GAAAA,U;;AAlBhB;;;;kBAEe,UAACC,KAAD,EAAQC,MAAR;AAAA,SAAmB;AAAA,sCAAIC,IAAJ;AAAIA,UAAJ;AAAA;;AAAA,WAAa,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC9E,UAAMC,SAASP,WAAWG,IAAX,CAAf;;AAEAD,aAAOM,KAAP,+DAA0BD,OAAOE,IAAjC,IAAuC,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACzD,YAAID,GAAJ,EAAS;AACPT,gBAAMW,MAAN,CAAaC,KAAb,CAAmBH,GAAnB;AACA,iBAAOJ,OAAO;AACZQ,oDAA0CJ,IAAII,IADlC;AAEZC,2JAAqCZ,KAAKa,IAAL,CAAU,GAAV,CAArC;AAFY,WAAP,CAAP;AAID;;AAEDX,gBAAQE,OAAOJ,IAAf;AACD,OAVD;AAWD,KAd8C,CAAb;AAAA,GAAnB;AAAA,C;;AAgBR,SAASH,UAAT,CAAoBG,IAApB,EAA0B;AAC/B,SAAOA,KAAKc,MAAL,CAAY,UAACV,MAAD,EAASW,GAAT,EAAiB;AAClCX,WAAOJ,IAAP,CAAae,GAAb,IAAqBC,KAAKC,GAAL,EAArB;AACAb,WAAOE,IAAP,CAAYY,IAAZ,CAAiBH,GAAjB;AACAX,WAAOE,IAAP,CAAYY,IAAZ,CAAiBd,OAAOJ,IAAP,CAAae,GAAb,CAAjB;AACA,WAAOX,MAAP;AACD,GALM,EAKJ,EAAEE,MAAM,EAAR,EAAYN,MAAM,EAAlB,EALI,CAAP;AAMD","file":"set.js","sourcesContent":["import { TAGS_KEY } from './constants';\n\nexport default (micro, client) => (...tags) => new Promise((resolve, reject) => {\n  const result = reduceTags(tags);\n\n  client.hmset(TAGS_KEY, ...result.keys, function (err, res) {\n    if (err) {\n      micro.logger.error(err);\n      return reject({\n        code   : `error.plugin-cache-redis.tag/${ err.code }`,\n        message: `Попытка установки тегов ${ tags.join(',') } привела к ошибке`\n      });\n    }\n\n    resolve(result.tags);\n  });\n});\n\nexport function reduceTags(tags) {\n  return tags.reduce((result, tag) => {\n    result.tags[ tag ] = Date.now();\n    result.keys.push(tag);\n    result.keys.push(result.tags[ tag ]);\n    return result;\n  }, { keys: [], tags: {} });\n}"]}