{"version":3,"sources":["../../../src/decorators/tags/set.js"],"names":["micro","client","tags","Promise","resolve","reject","result","reduce","tag","Date","now","keys","push","hmset","err","logger","error","code","message","join"],"mappings":";;;;;;AAAA;;;;kBAEe,UAACA,KAAD,EAAQC,MAAR;AAAA,SAAmB;AAAA,sCAAIC,IAAJ;AAAIA,UAAJ;AAAA;;AAAA,WAAa,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC9E,UAAMC,SAASJ,KAAKK,MAAL,CAAY,UAACD,MAAD,EAASE,GAAT,EAAiB;AAC1CF,eAAOJ,IAAP,CAAaM,GAAb,IAAqBC,KAAKC,GAAL,EAArB;AACAJ,eAAOK,IAAP,CAAYC,IAAZ,CAAiBJ,GAAjB;AACAF,eAAOK,IAAP,CAAYC,IAAZ,CAAiBN,OAAOJ,IAAP,CAAaM,GAAb,CAAjB;AACA,eAAOF,MAAP;AACD,OALc,EAKZ,EAAEK,MAAM,EAAR,EAAYT,MAAM,EAAlB,EALY,CAAf;;AAOAD,aAAOY,KAAP,+DAA0BP,OAAOK,IAAjC,IAAuC,UAAUG,GAAV,EAAeR,MAAf,EAAuB;AAC5D,YAAIQ,GAAJ,EAAS;AACPd,gBAAMe,MAAN,CAAaC,KAAb,CAAmBF,GAAnB;AACA,iBAAOT,OAAO;AACZY,oDAA0CH,IAAIG,IADlC;AAEZC,2JAAqChB,KAAKiB,IAAL,CAAU,GAAV,CAArC;AAFY,WAAP,CAAP;AAID;;AAEDf,gBAAQE,OAAOJ,IAAf;AACD,OAVD;AAWD,KAnB8C,CAAb;AAAA,GAAnB;AAAA,C","file":"set.js","sourcesContent":["import { TAGS_KEY } from './constants';\n\nexport default (micro, client) => (...tags) => new Promise((resolve, reject) => {\n  const result = tags.reduce((result, tag) => {\n    result.tags[ tag ] = Date.now();\n    result.keys.push(tag);\n    result.keys.push(result.tags[ tag ]);\n    return result;\n  }, { keys: [], tags: {} });\n\n  client.hmset(TAGS_KEY, ...result.keys, function (err, result) {\n    if (err) {\n      micro.logger.error(err);\n      return reject({\n        code   : `error.plugin-cache-redis.tag/${ err.code }`,\n        message: `Попытка установки тегов ${ tags.join(',') } привела к ошибке`\n      });\n    }\n\n    resolve(result.tags);\n  });\n});"]}