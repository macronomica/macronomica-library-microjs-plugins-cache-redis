{"version":3,"sources":["../src/get-key.js"],"names":["micro","client","key","callback","options","Promise","resolve","reject","get","err","result","logger","error","code","message","then","catch"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;kBAEe,UAACA,KAAD,EAAQC,MAAR;AAAA,SAAmB,UAACC,GAAD,EAAMC,QAAN;AAAA,QAAgBC,OAAhB,uEAA0B,EAA1B;AAAA,WAAiC,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAClGN,aAAOO,GAAP,CAAWN,GAAX,EAAgB,UAAUO,GAAV,EAAeC,MAAf,EAAuB;AACrC,YAAID,GAAJ,EAAS;AACPT,gBAAMW,MAAN,CAAaC,KAAb,CAAmBH,GAAnB;AACA,iBAAOF,OAAO;AACZM,oDAA0CJ,IAAII,IADlC;AAEZC,2JAAqCZ,GAArC;AAFY,WAAP,CAAP;AAID;;AAED,YAAIQ,WAAW,IAAf,EAAqB;;AAEnB,cAAI,sBAAWP,QAAX,CAAJ,EAA0B;AACxB,mBAAO,sBAAIH,KAAJ,EAAWC,MAAX,EAAmBC,GAAnB,EAAwBC,SAASD,GAAT,CAAxB,EACJa,IADI,CACCT,OADD,EAEJU,KAFI,CAEET,MAFF,CAAP;AAGD;AACF;;AAEDD,gBAAQI,MAAR;AACD,OAnBD;AAoBD,KArBkE,CAAjC;AAAA,GAAnB;AAAA,C","file":"get-key.js","sourcesContent":["import isFunction from 'lodash.isfunction';\nimport isPlainObject from 'lodash.isplainobject';\nimport set from './set-key';\n\nexport default (micro, client) => (key, callback, options = {}) => new Promise((resolve, reject) => {\n  client.get(key, function (err, result) {\n    if (err) {\n      micro.logger.error(err);\n      return reject({\n        code   : `error.plugin-cache-redis.get/${ err.code }`,\n        message: `Попытка получения ключа ${ key } привела к ошибке`\n      });\n    }\n    \n    if (result === null) {\n      \n      if (isFunction(callback)) {\n        return set(micro, client)(key, callback(key))\n          .then(resolve)\n          .catch(reject);\n      }\n    }\n    \n    resolve(result);\n  });\n});"]}