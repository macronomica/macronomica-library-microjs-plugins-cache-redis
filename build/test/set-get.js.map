{"version":3,"sources":["../../src/test/set-get.js"],"names":["should","micro","logger","error","console","err","client","createClient","delWrapper","getWrapper","setWrapper","getNullValue","then","getValueAsCallback","getValueAsAsyncCallback","getValue","setValue","Promise","all","quit","describe","it","equal","result","done","success","log","key","id","resolve"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,SAAS,eAAKA,MAAL,EAAf;AACA,IAAMC,QAAQ;AACZC,UAAQ,EAAEC,OAAO;AAAA,aAAOC,QAAQD,KAAR,CAAcE,GAAd,CAAP;AAAA,KAAT;AADI,CAAd;AAGA,IAAMC,SAAS,gBAAWC,YAAX,EAAf;;AAEA,IAAMC,aAAa,yBAAIP,KAAJ,EAAWK,MAAX,CAAnB;AACA,IAAMG,aAAa,sBAAIR,KAAJ,EAAWK,MAAX,CAAnB;AACA,IAAMI,aAAa,wBAAIT,KAAJ,EAAWK,MAAX,CAAnB;;AAEAK,eACGC,IADH,CACQC,kBADR,EAEGD,IAFH,CAEQ;AAAA,SAAMJ,WAAW,aAAX,CAAN;AAAA,CAFR,EAGGI,IAHH,CAGQE,uBAHR,EAIGF,IAJH,CAIQG,QAJR,EAKGH,IALH,CAKQI,QALR,EAMGJ,IANH,CAMQ;AAAA,SAAMK,QAAQC,GAAR,CAAY,CACtBV,WAAW,UAAX,CADsB,EAEtBA,WAAW,aAAX,CAFsB,EAGtBA,WAAW,iBAAX,CAHsB,CAAZ,CAAN;AAAA,CANR,EAWGI,IAXH,CAWQ;AAAA,SAAMN,OAAOa,IAAP,EAAN;AAAA,CAXR;;AAcAC,SAAS,KAAT,EAAgB,YAAW;AACzBC,KAAG,qBAAH,EAA0B,gBAAQ;;AAEhCZ,eAAW,UAAX,EACGG,IADH,CACQ,kBAAU;AACdZ,aAAOsB,KAAP,CAAa,IAAb,EAAmBC,MAAnB;AACAC;AACD,KAJH,EAIKA,IAJL;AAKD,GAPD;AAQD,CATD;;AAWA,SAASb,YAAT,GAAwB;AACtB,SAAOF,WAAW,UAAX,EACJG,IADI,CACCa,OADD,EACUtB,KADV,CAAP;AAED;;AAED,SAASU,kBAAT,GAA8B;AAC5B,SAAOJ,WAAW,aAAX,EAA0B,eAAO;AACtCL,YAAQsB,GAAR,6FAAiCC,GAAjC;AACA,WAAO,EAAEC,IAAI,CAAN,EAAP;AACD,GAHM,EAGJhB,IAHI,CAGCa,OAHD,EAGUtB,KAHV,CAAP;AAID;;AAED,SAASW,uBAAT,GAAmC;AACjC,SAAOL,WAAW,aAAX,EAA0B,eAAO;AACtCL,YAAQsB,GAAR,6FAAiCC,GAAjC;AACA,WAAOV,QAAQY,OAAR,CAAgB,EAAED,IAAI,CAAN,EAAhB,CAAP;AACD,GAHM,EAGJhB,IAHI,CAGCa,OAHD,EAGUtB,KAHV,CAAP;AAID;;AAED,SAASY,QAAT,GAAoB;AAClB,SAAON,WAAW,aAAX,EAA0BG,IAA1B,CAA+Ba,OAA/B,EAAwCtB,KAAxC,CAAP;AACD;;AAED,SAASa,QAAT,GAAoB;AAClB,SAAON,WAAW,iBAAX,EAA8B,EAAEkB,IAAI,CAAN,EAA9B,EAAyChB,IAAzC,CAA8Ca,OAA9C,EAAuDtB,KAAvD,CAAP;AACD;;AAED,SAASsB,OAAT,CAAiBF,MAAjB,EAAyB;AACvBnB,UAAQsB,GAAR,CAAYH,MAAZ;AACD;;AAED,SAASpB,KAAT,CAAeA,KAAf,EAAsB;AACpBC,UAAQD,KAAR,CAAcA,KAAd;AACD","file":"set-get.js","sourcesContent":["import chai from 'chai';\nimport middleware from 'redis';\nimport get from '../decorators/get-key';\nimport del from '../decorators/remove-key';\nimport set from '../decorators/write-key';\n\nconst should = chai.should();\nconst micro = {\n  logger: { error: err => console.error(err) }\n};\nconst client = middleware.createClient();\n\nconst delWrapper = del(micro, client);\nconst getWrapper = get(micro, client);\nconst setWrapper = set(micro, client);\n\ngetNullValue()\n  .then(getValueAsCallback)\n  .then(() => delWrapper('test-run-cb'))\n  .then(getValueAsAsyncCallback)\n  .then(getValue)\n  .then(setValue)\n  .then(() => Promise.all([\n    delWrapper('test-get'),\n    delWrapper('test-run-cb'),\n    delWrapper('test-set-object')\n  ]))\n  .then(() => client.quit())\n;\n\ndescribe('api', function() {\n  it('должен вернуть null', done => {\n  \n    getWrapper('test-get')\n      .then(result => {\n        should.equal(null, result);\n        done();\n      }, done);\n  });\n});\n\nfunction getNullValue() {\n  return getWrapper('test-get')\n    .then(success, error);\n}\n\nfunction getValueAsCallback() {\n  return getWrapper('test-run-cb', key => {\n    console.log(`Данных для ключа ${ key } нет, вставляем новые`);\n    return { id: 1 };\n  }).then(success, error);\n}\n\nfunction getValueAsAsyncCallback() {\n  return getWrapper('test-run-cb', key => {\n    console.log(`Данных для ключа ${ key } нет, вставляем новые`);\n    return Promise.resolve({ id: 1 });\n  }).then(success, error);\n}\n\nfunction getValue() {\n  return getWrapper('test-run-cb').then(success, error);\n}\n\nfunction setValue() {\n  return setWrapper('test-set-object', { id: 2 }).then(success, error);\n}\n\nfunction success(result) {\n  console.log(result);\n}\n\nfunction error(error) {\n  console.error(error);\n}"]}